<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minimal Task List</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-512.png">
<meta name="theme-color" content="#3b2f2f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #3b2f2f;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#taskInput {
  width: 92%;
  max-width: 480px;
  padding: 16px;
  font-size: 20px;
  border-radius: 14px;
  border: none;
  outline: none;
  margin-top: 14px;
  background: #bbf7d0;
  color: #3b2f2f;
}

#charCount {
  width: 92%;
  max-width: 480px;
  text-align: right;
  font-size: 12px;
  color: #ddd;
  margin-top: 4px;
  margin-bottom: 6px;
}

.toolbar {
  width: 92%;
  max-width: 480px;
  display: flex;
  gap: 10px;
  margin: 10px 0 6px;
}

.toolbar button {
  flex: 1;
  padding: 8px 0;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  background: #4a3838;
  color: #fff;
}

.toolbar button.active { background: #2563eb; }

.tasks {
  width: 92%;
  max-width: 480px;
  margin-top: 10px;
}

.task-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #4a3838;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 6px;
  font-size: 16px;
  word-break: break-word;
}

.task-text.completed {
  text-decoration: line-through;
  opacity: 0.6;
}

.task-meta {
  font-size: 11px;
  color: #ccc;
  margin-left: 6px;
}

.task-buttons button {
  margin-left: 4px;
  border: none;
  border-radius: 6px;
  padding: 4px 6px;
  font-size: 12px;
  background: #3b2f2f;
  color: #fff;
}
</style>
</head>
<body>

<textarea id="taskInput" maxlength="160" placeholder="Enter task (max 160 chars)…"></textarea>
<div id="charCount">160</div>

<div class="toolbar">
  <button id="addTaskBtn">+ Add Task</button>
  <button id="clearAllBtn">Clear All</button>
</div>

<div class="tasks" id="tasksContainer"></div>

<script>
const taskInput = document.getElementById('taskInput');
const charCount = document.getElementById('charCount');
const addTaskBtn = document.getElementById('addTaskBtn');
const clearAllBtn = document.getElementById('clearAllBtn');
const tasksContainer = document.getElementById('tasksContainer');

let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');

function updateCharCount() {
  charCount.textContent = 160 - taskInput.value.length;
}
taskInput.addEventListener('input', updateCharCount);
updateCharCount();

function saveTasks() {
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

function renderTasks() {
  tasksContainer.innerHTML = '';
  tasks.forEach((task, index) => {
    const taskDiv = document.createElement('div');
    taskDiv.className = 'task-item';

    const textSpan = document.createElement('span');
    textSpan.className = 'task-text';
    if (task.completed) textSpan.classList.add('completed');
    textSpan.textContent = task.text;

    const metaSpan = document.createElement('span');
    metaSpan.className = 'task-meta';
    metaSpan.textContent = task.tags ? `#${task.tags.join(', ')} • ${task.timestamp}` : task.timestamp;

    const btnDiv = document.createElement('div');
    btnDiv.className = 'task-buttons';

    const toggleBtn = document.createElement('button');
    toggleBtn.textContent = task.completed ? 'Undo' : 'Done';
    toggleBtn.onclick = () => {
      task.completed = !task.completed;
      saveTasks();
      renderTasks();
    };

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '×';
    deleteBtn.onclick = () => {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
    };

    btnDiv.appendChild(toggleBtn);
    btnDiv.appendChild(deleteBtn);

    taskDiv.appendChild(textSpan);
    taskDiv.appendChild(metaSpan);
    taskDiv.appendChild(btnDiv);

    tasksContainer.appendChild(taskDiv);
  });
}

addTaskBtn.onclick = () => {
  if (!taskInput.value.trim()) return;
  const timestamp = new Date().toLocaleString();
  tasks.unshift({ text: taskInput.value.trim(), completed: false, tags: [], timestamp });
  saveTasks();
  renderTasks();
  taskInput.value = '';
  updateCharCount();
};

clearAllBtn.onclick = () => {
  if (!confirm('Clear all tasks?')) return;
  tasks = [];
  saveTasks();
  renderTasks();
};

renderTasks();
</script>

</body>
</html>
